<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="alternate icon" href="images/favicon.ico">
    <link rel="mask-icon" href="images/favico-tab.svg" color="#500000">
    <script src="js/datatables.js"></script>
    <title>Rust Risk</title>
    <link rel="stylesheet" href="/css/main.css" name="www-onepick">
    <!--<script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3js.org/queue.v1.min.js"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>-->
</head>

<body>
    <div id="error-notif" class="gradient-border" style="display: none;">
        <center><b id="error-notif-title">Please complete the captcha:</b><br /><br />
            <div id="error-notif-body">
                <img src="https://www.technotification.com/wp-content/uploads/2014/12/captcha_various-protection-modes-_screenshot-gif.gif" />
                <br /> Captcha: <input type="text" style="width:50%; margin: 10px;" placeholder="CODE"></input>
            </div>
        </center>
        <ul class="gradient-buttons">
            <li id="error-notif-button-1-container">
                <button id="error-notif-button-1" href="">Okay</button>
            </li>
            <li id="error-notif-button-2-container">
                <button id="error-notif-button-2" href="">Yikes</button>
            </li>
        </ul>
    </div>
    <nav class="navbar">
        <div class="col">
            <nav id="hamnav">
                <label for="hamburger">&#9776;</label>
                <input type="checkbox" id="hamburger" />
                <div class="hamitems">
                    <a href="index.html">Home</a>
                    <a href="leaderboard.html">Leaderboard</a>
                    <a href="odds.html">Odds</a>
                    <a href="info.html">Info</a>
                    <a href="https://github.com/mautamu/Risk/blob/stable/documentation/API.md">API</a>
                </div>
            </nav>
        </div>
        <div class="col">
            <a href="/" class="loader" target="_self">
                <img src="images/logo-text-white.svg" class="brand-tag">
                <img src="images/logo-white.svg" id="loadicon" class="brand-image spin">
            </a>
        </div>
        <div class="col">
            <div class="hamitems" style="float:right;">
                <a class="navbar-brand rj" href="/login/reddit">
                    <img src="images/reddit-logo.png" class="brand-image"></img>
                </a>
            </div>
        </div>
    </nav>
    <div class="central-console">
        <div class="row row-container">
            <div class="col flx cold">
                <div class="flex">
                    <div id="playerCard" class="content unflex">
                    </div>
                </div>
            </div>
            <div class="col2 cold">
                <div class="flex mapfix">
                    <div id="map-info">
                        <b id="map-county-info"></b>
                        <i style="font-size: 14px;" id="map-owner-info"></i>
                    </div>
                    <div id="map-container" class="fc jc">
                    </div>
                </div>
            </div>
            <div class="row row-container">
                <div class="col cold">
                    <div class="flex">
                        <div class="content">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
                            in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </div>
                    </div>
                </div>
                <div class="col cold">
                    <div class="flex">
                        <div class="content">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
                            in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </div>
                    </div>
                </div>
                <div class="col cold">
                    <div class="flex">
                        <div class="content unflex">
                            The Rust Risk logo is a derivative work of the <a href="https://www.rust-lang.org/policies/media-guide">Rust</a> logo, created by Mozilla and licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div class="row row-container">
                    <div class="col3 cold">
                        <div class="flex">
                            <div class="content unflex">
                                <center>
                                    <h2>
                                        Playing Rust Risk
                                    </h2>
                                </center>
                                <h3> What is Rust Risk? </h3>
                                <p id="#what">
                                    Aggie Risk is similar to <a href="https://collegefootballrisk.com/">College Football Risk</a>. It is a multiplayer game where teams can work together to control a map of the state of Texas. The objective is for a team
                                    to have the largest number of territories of any team at the end of the season.
                                </p>
                                <h3> How does the game work? </h3>
                                <p id="#gameplay">
                                    Every day at 22:00 U.S. Central Standard Time, the map is redrawn. For each territory on the map, the total <a href="#starpower">starpower</a> is calculated for each team that made moves in that territory. A random
                                    number is drawnn and the team who's player that number corresponds to is labeled
                                    <a href="#mvp">MVP</a> and wins the territory for that team.
                                </p>
                                <h3> How is this different from College Football Risk? </h3>
                                <p>
                                    This game is quite similar to CFR. However, this version of the game is predominately open-source. Anyone can go look at its <a href="https://github.com/kennroo/Risk">code</a>, and submit pull requests to change the
                                    game. <br /> This version of the game is written in the programming language <a href="https://www.rust-lang.org/" style="color:#B9420F;">Rust</a>. A list of ways it deviates from CFR can be found on the <a href="https://github.com/kennroo/Risk">GitHub</a>.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width:100%;" id="leaderboard-container">
                <div class="row row-container">
                    <div class="col3 cold">
                        <div class="flex">
                            <div class="content fd jc">
                                <center>
                                    <h2>Leaderboard</h2>
                                </center>
                                <div id="leaderboard">
                                    <table id="leaderboard-table">
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script id="templateMapCss" type="text/template">
                <style>
                    #map {
                        width: 100%;
                        margin: auto;
                        margin-left: auto;
                        margin-right: auto;
                        width: 700px;
                    }
                    
                    #map path {
                        cursor: pointer;
                        pointer-events: all;
                        fill: purple;
                    }
                    /*path:hover {
          fill: pink !important;
        }*/
                </style>
            </script>
            <script id="templatePlayerCard" type="text/template">
                <center>
                    <h2>{{user_name}}<br>
                        <text style="color: {{user_team_color}}; font-size: 2em; --darkreader-inline-color:#cfcbc4;" data-darkreader-inline-color="">
                      {{overall}}
                    </text>
                        <style>
                            .lrow {
                                display: flex;
                                justify-content: center;
                            }
                            
                            .lcol2 {
                                flex: 2;
                                flex-basis: 50%;
                            }
                            
                            .lcol {
                                flex: 1;
                                flex-basis: 33%;
                            }
                        </style>
                        <style class="darkreader darkreader--sync" media="screen"></style>
                        <div class="lrow">
                            <div class="lcol">
                                {{total_turns_stars}} <br>
                                <i style="font-size:0.5em;">Total turns:</i><br> {{total_turns}}
                            </div>
                            <div class="lcol">
                                {{round_turns_stars}} <br>
                                <i style="font-size:0.5em;">Round turns:</i><br> {{round_turns}}
                            </div>
                            <div class="lcol">
                                {{mvps_stars}} <br>
                                <i style="font-size:0.5em;">MVPS:</i><br> {{mvps}}
                            </div>
                        </div>
                        <br>
                        <div class="lrow">
                            <div class="lcol2">
                                {{streak_stars}}<br>
                                <i style="font-size:0.5em;">Streak: </i><br> {{streak}}
                            </div>
                            <div class="lcol2">
                                {{cfb_stars_stars}} <br>
                                <i style="font-size:0.5em;">CFB Stars:</i><br> {{cfb_stars}}
                            </div>
                        </div>
                    </h2>
                    <br>
                    <h2>{{team}}<br>
                        <img src="{{team_logo}}" width="128" height="128">
                        <div class="lrow">
                            <div class="lcol2">
                                {{team_players_yesterday}}<br>
                                <i style="font-size:0.5em;">Players yesterday</i><br>
                            </div>
                            <div class="lcol2">
                                {{team_mercs_yesterday}}<br>
                                <i style="font-size:0.5em;">Mercernaries yesterday</i><br>
                            </div>
                        </div>
                        <br>
                        <div class="lrow">
                            <div class="lcol2">
                                {{team_star_power_yesterday}}<br>
                                <i style="font-size:0.5em;">Star power</i><br>
                            </div>
                            <div class="lcol2">
                                {{team_territories_yesterday}}<br>
                                <i style="font-size:0.5em;">Territories</i><br>
                            </div>
                        </div>
                    </h2>
                </center>
            </script>
            <script>
                function errorNotif(title, body, button1, button2) {
                    document.getElementById('error-notif').style.display = "block";
                    document.getElementById('error-notif-title').innerHTML = title || "General Error";
                    document.getElementById('error-notif-body').innerHTML = body || "Hmm, no error was specified. Try notifying <a href=\"https://github.com/mautamu/risk\">u/Mautamu</a> if this issue persists.";
                    document.getElementById('error-notif-button-1').innerHTML = button1.text || "";
                    document.getElementById('error-notif-button-1-container').style.display = button1.display || "block";
                    document.getElementById('error-notif-button-1').onclick = function() {
                        if (typeof button1.action() != null) {
                            button1.action();
                        }
                        errorOver();
                    };
                    document.getElementById('error-notif-button-2').innerHTML = button2.text || "";
                    document.getElementById('error-notif-button-2-container').style.display = button2.display || "block";
                    document.getElementById('error-notif-button-2').onclick = function() {
                        if (typeof button1.action() != null) {
                            button2.action();
                        }
                        errorOver();
                    };
                }

                function errorOver() {

                }

                function togglehamitems() {
                    document.getElementById()
                }
                var outstandingRequests = [];
                var globalError = false;

                function doAjaxGetRequest(url, source, callback, errorcallback) {
                    //addUrlFromRequests(url);
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            callback(this);
                            // return JSON.parse(this.response);
                        } else if (this.readyState == 4 && this.status != 200) {
                            globalError = true;
                            errorcallback(this);
                            //updateLoaderVisibility();
                            //document.getElementsById("loadicon").classList.add("blink");
                        }
                    };
                    xhttp.open("GET", url, true);
                    xhttp.send();
                    // removeUrlFromRequests(url);
                }
                const userTheme = {
                    color: 'white',
                    frozenRowsColor: 'white',
                    defaultBgColor: 'rgba(0,0,0,1)',
                    frozenRowsBgColor: 'rgba(0,0,0,1)',
                    selectionBgColor: 'rgba(100,100,100,1)',
                    highlightBgColor: 'rgba(0,0,0,1)',
                    underlayBackgroundColor: 'rgba(0,0,0,1)',
                    frozenRowsBorderColor(args) {
                        const {
                            row,
                            grid: {
                                frozenRowCount
                            }
                        } = args;
                        if (frozenRowCount - 1 === row) {
                            return ['white' /*top*/ , '#F88' /*right and left*/ , 'red' /*bottom*/ ];
                        } else {
                            return '#white';
                        }
                    },
                    borderColor(args) {
                        const {
                            col,
                            grid: {
                                colCount
                            }
                        } = args;
                        if (colCount - 1 === col) {
                            return ['red' /*top*/ , '#F88' /*right*/ , 'red' /*bottom*/ , null /*left*/ ];
                        } else {
                            return ['red' /*top and bottom*/ , 'red' /*right and left*/ ];
                        }
                    },
                    highlightBorderColor: 'white',
                    checkbox: {
                        uncheckBgColor: '#FDD',
                        checkBgColor: 'rgb(255, 73, 72)',
                        borderColor: 'red',
                    },
                    button: {
                        color: '#FDD',
                        bgColor: '#F55',
                    },
                    font: '16px sans-serif',
                    header: {
                        sortArrowColor: '#D00'
                    }
                };

                function drawLeaderboard(season, day) {
                    doAjaxGetRequest('/api/stats/leaderboard', 'leaderboard request', function(leaderboard_data) {
                        //console.log(data);
                        let leaderboardObject = JSON.parse(leaderboard_data.response);
                        let display_headings = ["rank", "name", "territoryCount", "playerCount", "mercCount", "starPower", "efficiency"];

                        var obj = {
                            // Quickly get the headings
                            headings: ["Rank", "Name", "Territories", "Players", "Mercernaries", "Stars", "Efficiency"],

                            // data array
                            data: []
                        };

                        // Loop over the objects to get the values
                        for (var i = 0; i < leaderboardObject.length; i++) {

                            obj.data[i] = [];

                            for (var p in leaderboardObject[i]) {
                                if (leaderboardObject[i].hasOwnProperty(p) && display_headings.indexOf(p) != -1) {
                                    if (p == 'name') {
                                        obj.data[i].push("<img width='30px' src='" + leaderboardObject[i]['logo'] + "'/>".concat(leaderboardObject[i][p]));
                                    } else {
                                        obj.data[i].push(leaderboardObject[i][p]);
                                    }
                                }
                            }
                        }

                        var datatable = new DataTable("#leaderboard-table", {
                            data: obj,
                            columns: obj.columns,
                            searchable: false,
                            perPageSelect: false,
                            footer: false,
                            labels: {
                                info: "",
                            }
                        });
                    });
                }

                drawLeaderboard(0, 0);
            </script>
            <script>
                function checkTeam(team, tname) {
                    return team.name == tname;
                }

                function getUserInfo(resolve, reject) {
                    try {
                        doAjaxGetRequest('/api/me', 'UserLoader', function(userObject) {
                                window.userObject = JSON.parse(userObject.response);
                                //see if user has a team, if not, prompt them and halt
                                if (window.userObject.active_team.name == null) {
                                    //select a new team 4 the season! whoohoo!
                                    if (window.userObject.team == null) {
                                        //select a team in general!! whoohoo!
                                        select_team = "<p>Welcome! <br/> To get started, you will need to select a team.</p><form action=\"auth/join\" method=\"GET\" id=\"team-submit-form\"> <select name=\"team\" id=\"team\">";
                                        teamsObject.forEach(function(team) {
                                            select_team += "<option name=\"team\" value=\"" + team.id + "\">" + team.name + "</option>";
                                        });
                                        select_team += "</select><div id=\"team-submit-form-error\"></div></form>";
                                        errorNotif('Select a Team', select_team, {
                                            text: "Join",
                                            action: function() {
                                                doAjaxGetRequest(encodeURI('/auth/join?team='.concat(document.getElementById("team").value)), 'TeamSelector', function(status) {
                                                    if (status.status == 200) {
                                                        location.reload();
                                                    }
                                                }, function(status) {
                                                    if (status.status == 409) {
                                                        //user has team, 
                                                    } else if (status.status == 403) {
                                                        //team has no territories!
                                                        document.getElementById('team-submit-form-error').innerHTML = "<br/><br/> <b style=\"color:red;\">Sorry, but this team is out of the running. Try another.</b>";
                                                    } else {

                                                    }
                                                });
                                            }
                                        }, {
                                            display: "none",
                                        });
                                    } else {
                                        //oh no! your team has been e l i m i n a t e d 
                                        //oh no! your team has been e l i m i n a t e d 
                                        select_team = "<p>Oh no! Your team has been <b>eliminated. Select a new one to play as:</b> </p><form action=\"auth/join\" method=\"GET\" id=\"team-submit-form\"> <select name=\"team\" id=\"team\">";
                                        teamsObject.forEach(function(team) {
                                            select_team += "<option name=\"team\" value=\"" + team.id + "\">" + team.name + "</option>";
                                        });
                                        select_team += "</select><div id=\"team-submit-form-error\"></div></form>";
                                        errorNotif('Select a Team', select_team, {
                                            text: "Join",
                                            action: function() {
                                                doAjaxGetRequest(encodeURI('/auth/join?team='.concat(document.getElementById("team").value)), 'TeamSelector', function(status) {
                                                    if (status.status == 200) {
                                                        location.reload();
                                                    }
                                                }, function(status) {
                                                    if (status.status == 409) {
                                                        //user has team, 
                                                    } else if (status.status == 403) {
                                                        //team has no territories!
                                                        document.getElementById('team-submit-form-error').innerHTML = "<br/><br/> <b style=\"color:red;\">Sorry, but this team is out of the running. Try another.</b>";
                                                    } else {

                                                    }
                                                });
                                            }
                                        });
                                    }
                                } else {
                                    doAjaxGetRequest(encodeURI('/api/stats/team?team='.concat(window.userObject.team.name)).replace(/&/, '%26'), 'TeamLoader', function(teamObject) {
                                        teamObject = JSON.parse(teamObject.response);
                                        userObject = window.userObject;
                                        var template = document.getElementById("templatePlayerCard");

                                        var templateHtml = template.innerHTML;

                                        var listHtml = "";
                                        var index = 0;
                                        for (i in window.teamsObject) {
                                            if (window.teamsObject[i].name == teamObject.team) {
                                                index = i;
                                            }
                                        }
                                        listHtml += templateHtml
                                            .replace(/{{user_name}}/g, userObject.name)
                                            .replace(/{{user_team_color}}/, userObject.team.colors.primary)
                                            .replace(/{{overall}}/g, "✯".repeat(userObject.ratings.overall))
                                            .replace(/{{total_turns_stars}}/g, "✯".repeat(userObject.ratings.totalTurns))
                                            .replace(/{{round_turns_stars}}/g, "✯".repeat(userObject.ratings.gameTurns))
                                            .replace(/{{mvps_stars}}/g, "✯".repeat(userObject.ratings.mvps))
                                            .replace(/{{streak_stars}}/g, "✯".repeat(userObject.ratings.streak))
                                            .replace(/{{cfb_stars_stars}}/g, "✯".repeat(userObject.ratings.awards))
                                            .replace(/{{total_turns}}/g, userObject.stats.totalTurns)
                                            .replace(/{{round_turns}}/g, userObject.stats.gameTurns)
                                            .replace(/{{mvps}}/g, userObject.stats.mvps)
                                            .replace(/{{streak}}/g, userObject.stats.streak)
                                            .replace(/{{cfb_stars}}/g, userObject.stats.awards)
                                            .replace(/{{team}}/g, teamObject.team || "")
                                            .replace(/{{team_players_yesterday}}/g, teamObject.players || "0")
                                            .replace(/{{team_mercs_yesterday}}/g, teamObject.mercs || "0")
                                            .replace(/{{team_star_power_yesterday}}/g, teamObject.stars || "0")
                                            .replace(/{{team_territories_yesterday}}/g, teamObject.territories || "0")
                                            .replace(/{{team_logo}}/g, window.teamsObject[index].logo || "0");
                                        document.getElementById("playerCard").innerHTML = listHtml;
                                    });


                                }
                            },
                            function() {
                                //display reddit login info
                                document.getElementById("playerCard").classList.add("redditlogin");
                                document.getElementById("playerCard").innerHTML = "<a href=\"/login/reddit\"><div style=\"margin-top:50%;\" ><img src=\"images/reddit-logo.png\"><br/><br/>LOGIN</div></a>";
                            });
                    } catch {
                        console.log("Error setting up user card");
                    }
                }
                const loadUser = (new Promise(getTeamInfo))
                    .then(drawMap)
                    .then(getUserInfo, console.log)
                    .finally(setupMapHover);

                function setupMapHover(status) {
                    document.addEventListener('mouseover', function(event) {
                        if (!event.target.matches('path')) return;
                        event.preventDefault();
                        document.getElementById("map-county-info").innerHTML = event.target.attributes["name"].value;
                        document.getElementById("map-owner-info").innerHTML = event.target.attributes["owner"].value;
                        event.target.style.fill = event.target.style.fill.replace('-primary', '-secondary');
                    }, false);
                    document.addEventListener('mouseout', function(event) {
                        if (!event.target.matches('path')) return;
                        event.preventDefault();
                        document.getElementById("map-county-info").innerHTML = event.target.attributes["name"].value;
                        document.getElementById("map-owner-info").innerHTML = event.target.attributes["owner"].value;
                        event.target.style.fill = event.target.style.fill.replace('-secondary', '-primary');
                    }, false);
                }

                function getTeamInfo(resolve, reject) {
                    try {
                        doAjaxGetRequest('/api/teams', 'Teams', function(team_data) {
                            window.teamsObject = JSON.parse(team_data.response);
                            console.log(window.teamsObject);
                            for (team in window.teamsObject) {
                                document.documentElement.style
                                    .setProperty('--'.concat(teamsObject[team].name.replace(/\W/g, '')).concat('-primary'), teamsObject[team].colors.primary);
                                document.documentElement.style
                                    .setProperty('--'.concat(teamsObject[team].name.replace(/\W/g, '')).concat('-secondary'), teamsObject[team].colors.secondary);
                            }
                        });
                        resolve("Okay");
                    } catch {
                        reject("Error loading team info");
                    }
                }


                function drawMap(resolve, reject) {
                    doAjaxGetRequest('images/map.svg', 'Map', function(data) {
                        var style = document.getElementById("templateMapCss").innerHTML;
                        document.getElementById('map-container').innerHTML = data.response;
                        document.getElementById('map-container').innerHTML += style;
                        //now to fetch territory ownership!!
                        doAjaxGetRequest('/api/territories', 'Territories', function(territory_data) {
                            let territories = JSON.parse(territory_data.response);
                            for (territory in territories) {
                                document.getElementById('map').getElementById(territories[territory].name.replace(/ /, "")).style.fill = 'var(--'.concat(territories[territory].owner.replace(/\W/g, '').concat('-primary)'));
                                document.getElementById('map').getElementById(territories[territory].name.replace(/ /, "")).setAttribute('owner', territories[territory].owner);
                            }
                        });
                    });
                }
            </script>
</body>

</html>